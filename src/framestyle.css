
/* Frame-specific smooth transitions */
#frame {
  will-change: transform;
}

#frame .mark,
#frame .boundary,
#frame .lock-overlay {
  will-change: transform, opacity;
}

.mark {
  position: absolute;
  background-color: #03ffce;
  overflow: hidden;
  animation: pulsate 2s ease-in-out infinite;
  box-shadow: 0 0 0 0 rgba(3, 255, 206, 0.7);
}

@keyframes pulsate {
  0% {
    box-shadow: 0 0 0 0 rgba(3, 255, 206, 0.7);
  }
  50% {
    box-shadow: 0 0 0 10px rgba(3, 255, 206, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(3, 255, 206, 0);
  }
}

.preview-settings {
  max-width: 1000px;
  margin: 20px auto;
  padding: 20px;
  background: #fff;
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin-top: 0px;
}

.upload-section {
  text-align: center;
}

.upload-section label {
  font-size: 1.2em;
  margin-right: 10px;
}

.upload-section input[type="file"] {
  font-family: var(--heading-font);
  padding: 5px;
}

.controls {
  display: flex;
  justify-content: space-between;
  gap: 20px;
}

.area-size, .positions {
  flex: 1;
  padding: 15px;
}

.area-size h2, .positions h2 {
  font-family: var(--heading-font);
  margin-bottom: 10px;
  color: var(--heading-color);
}

.area-size button, .positions button {
  background: var(--accent-color);
  color: var(--contrast-color);
  font-family: var(--heading-font);
  border: none;
  border-radius: 5px;
  padding: 5px;
  margin: 5px;
  cursor: pointer;
  transition: background 0.3s ease;
}
.positions > div{
  flex: 1;
  padding: 10px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}
.area-size button:hover, .positions button:hover {
  background: #0cc29d;
}

.area-size input {
  padding: 8px;
  margin: 5px;
  border: 1px solid #ccc;
  border-radius: var(--button-radius);
  font-family: var(--heading-font);
}

@media screen and (max-width: 768px) {
  .controls {
    flex-direction: column;
  }
}
/* Center the upload control */
.upload-section{
  text-align:center;
}

/* Hide the real input but keep it accessible */
.file-input-visually-hidden{
  position:absolute !important;
  width:1px;height:1px;
  padding:0;margin:-1px;border:0;
  overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;
}

/* Generic button */
.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:.5rem;
  padding:.65rem 1.1rem;
  border-radius: var(--button-radius,6px);
  font: 600 0.95rem/1 var(--heading-font, inherit);
  border:1px solid transparent;
  cursor:pointer; user-select:none;
  text-decoration:none;
  transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;
}

/* Accent style that matches your palette */
.btn-accent{
  background: var(--accent-color);
  color: var(--contrast-color);
  box-shadow: 0 4px 14px rgba(0,0,0,.18);
}
.btn-accent:hover,
.btn-accent:focus-visible{
  filter: brightness(0.95);
  box-shadow: 0 6px 20px rgba(0,0,0,.24);
}
.btn-accent:active{ transform: translateY(1px); }

/* Upload button tweaks */
.btn-upload i{ font-size:1.1rem; line-height:0; }

/* Optional: chosen file name */
.file-name{
  display:block;
  margin-top:.5rem;
  font-size:.9rem;
  color: var(--heading-color);
  opacity:.75;
}

/* ===== Xpixel: responsive square ===== */
#frame{
  position: relative;
  width: clamp(260px, 92vw, 960px); /* fills small screens, caps on large */
  aspect-ratio: 1 / 1;             /* always a square */
  margin: 0 auto 28px;
  border-radius: 12px;
  background: #0f1012 url('/WEBPIX/media/images/Xpixel_frame.png') center/cover no-repeat;
  overflow: hidden;
  box-shadow: 0 12px 34px rgba(0,0,0,.35);
}

/* Grid that fills the square */
#frame .grid{
  display: grid;
  grid-template-columns: repeat(var(--cols, 100), 1fr);
  gap: 0;
  width: 100%;
  height: 100%;
}

/* Each cell is square, so the whole grid tiles perfectly */
#frame .pixel{
  aspect-ratio: 1 / 1;
  background: #68696b;
  border: 1px solid rgba(255,255,255,.035);
}

/* Selection overlay scales with the grid using percentages */
#frame .selection{
  position: absolute;
  left: 0; top: 0; width: 0; height: 0;
  border: 2px dashed var(--accent-color);
  border-radius: 6px;
  box-shadow: inset 0 0 0 9999px rgba(0,0,0,.22);
  transition: left .12s, top .12s, width .12s, height .12s;
  pointer-events: none;
}
#frame .selection .preview{
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  object-fit: cover; border-radius: 4px;
}
/* ======== Sector boundaries & locks ======== */

/* Put grid below overlays, mark above */
#frame .grid{ position: relative; z-index: 1; }
#frame .mark{ z-index: 3; }

/* Dashed boundary squares (centered) */
#frame .boundary{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  border: 2px dashed rgba(3,255,206,.75); /* uses your accent hue */
  border-radius: 8px;
  pointer-events:none;
  z-index: 2;
}

/* Little corner tags for labels */
#frame .sector-tag{
  position:absolute; bottom: 8px; right: 8px;
  background: rgba(15,16,18, 0.85);
  color: #03ffce;
  padding: 4px 8px;
  font: 600 12px/1.1 var(--heading-font);
  border-radius: 6px;
  border: 1px solid rgba(3,255,206,.35);
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  white-space: nowrap;
  backdrop-filter: blur(4px);
}

/* Outer edge label stays outside */
#frame .sector-tag-outer{
  top:-14px; left:-2px; bottom: auto; right: auto;
  transform: translateY(-100%);
}

/* Blur lock overlay for Stage 2 & 3 */
#frame .lock-overlay{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%);
  border-radius: 8px;
  background: rgba(0,0,0,.18);
  /* real blur where supported (iOS/Chrome/Safari) */
  backdrop-filter: blur(3px) saturate(0.8);
  /* fallback if no backdrop-filter */
  -webkit-backdrop-filter: blur(3px) saturate(0.8);
  z-index: 2; /* under the .mark */
  pointer-events:none;
}

/* Optional lock label badge */
#frame .lock-badge{
  position:absolute; right:8px; bottom:8px;
  background: rgba(0,0,0,.55);
  color: #fff;
  font: 600 12px/1.1 var(--heading-font);
  padding: 4px 8px;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,.15);
  letter-spacing:.2px;
}

/* Helper when we need to highlight illegal placement */
#frame .mark.is-invalid{
  outline: 2px solid #df1529;
  box-shadow: 0 0 0 2px rgba(223,21,41,.35) inset;
}
/* ============ Floating Position Pad (anchored inside #frame) ============ */
.position-pad{
  position: absolute;          /* anchored INSIDE #frame */
  right: 12px;
  bottom: 12px;
  z-index: 6;                  /* above toast(5), mark(3), lock(2) */
  width: 240px;
  color: #fff;
  background: linear-gradient(180deg, rgba(20,22,28,.98), rgba(20,22,28,.93));
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 12px;
  box-shadow: 0 14px 40px rgba(0,0,0,.35);
  user-select: none;
  touch-action: none;          /* predictable dragging on mobile */
}

@media (max-width: 768px){
  .position-pad{
    left: 50%;
    right: auto;
    transform: translateX(-50%);
    width: min(92vw, 320px);
  }
}

.position-pad .pad-head{
  display:flex; align-items:center; gap:8px;
  padding: 8px 10px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  cursor: grab;
}
.position-pad .pad-head:active{ cursor: grabbing; }
.position-pad .pad-title{
  font: 700 13px/1 var(--heading-font, system-ui);
  opacity: .9;
}
.position-pad .pad-actions{ margin-left:auto; display:flex; gap:6px; }
.position-pad .pad-actions .btn-ico{
  width:28px;height:28px; display:grid; place-items:center;
  background: transparent; border:1px solid rgba(255,255,255,.12);
  border-radius: 8px; color:#fff; opacity:.9; cursor:pointer;
}
.position-pad .pad-actions .btn-ico:hover{ background: rgba(255,255,255,.06); }

.position-pad.is-collapsed .pad-body{ display:none; }

.position-pad .pad-body{ padding: 10px; }
.position-pad .pad-grid{
  display:grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
}
.position-pad .pad-grid button{
  height: 52px; border-radius: 10px; border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.06);
  color:#fff; font: 700 18px/1 var(--heading-font, system-ui);
  display:grid; place-items:center; cursor:pointer;
  transition: transform .06s ease, background .2s ease, border-color .2s ease;
  touch-action: manipulation;
}
.position-pad .pad-grid button:active{ transform: translateY(1px); }
.position-pad .pad-grid button:hover{ background: rgba(255,255,255,.1); }

.position-pad .pad-step{
  display:flex; align-items:center; gap:10px; margin-top: 10px;
}
.position-pad .pad-step span{
  font: 700 12px/1 var(--heading-font, system-ui); opacity:.85; width: 42px;
}
.position-pad .pad-step input[type="range"]{
  flex:1; accent-color: var(--accent-color);
}
.position-pad .pad-step output{
  font: 700 12px/1 var(--heading-font, system-ui); opacity:.85;
  min-width: 58px; text-align:right;
}
/* ===== Anchored pad (desktop/tablet) ===== */
.position-pad{
  position: absolute;          /* inside #frame */
  right: 12px;
  bottom: 12px;
  z-index: 6;
  width: 240px;
  color: #fff;
  background: linear-gradient(180deg, rgba(20,22,28,.98), rgba(20,22,28,.93));
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 12px;
  box-shadow: 0 14px 40px rgba(0,0,0,.35);
  user-select: none;
  touch-action: none;
}
.position-pad .pad-head{ display:flex; align-items:center; gap:8px; padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.06); cursor:grab; }
.position-pad .pad-head:active{ cursor:grabbing; }
.position-pad .pad-title{ font:700 13px/1 var(--heading-font,system-ui); opacity:.9; }
.position-pad .pad-actions{ margin-left:auto; display:flex; gap:6px; }
.position-pad .btn-ico{ width:28px; height:28px; display:grid; place-items:center; background:transparent; border:1px solid rgba(255,255,255,.12); border-radius:8px; color:#fff; opacity:.9; cursor:pointer; }
.position-pad .btn-ico:hover{ background:rgba(255,255,255,.06); }
.position-pad.is-collapsed .pad-body{ display:none; }
.position-pad .pad-body{ padding:10px; }
.position-pad .pad-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
.position-pad .pad-grid button{
  height:52px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06); color:#fff; font:700 18px/1 var(--heading-font,system-ui);
  display:grid; place-items:center; cursor:pointer; transition:transform .06s ease, background .2s ease;
  touch-action:manipulation;
}
.position-pad .pad-grid button:hover{ background:rgba(255,255,255,.1); }
.position-pad .pad-grid button:active{ transform:translateY(1px); }
.position-pad .pad-step{ display:flex; align-items:center; gap:10px; margin-top:10px; }
.position-pad .pad-step span{ font:700 12px/1 var(--heading-font,system-ui); opacity:.85; width:42px; }
.position-pad .pad-step input[type="range"]{ flex:1; accent-color:var(--accent-color); }
.position-pad .pad-step output{ font:700 12px/1 var(--heading-font,system-ui); opacity:.85; min-width:58px; text-align:right; }

/* ===== Mobile: hide anchored pad, use FAB + bottom sheet ===== */
@media (max-width: 767.98px){
  .position-pad{ display:none !important; }
}

/* FAB inside the frame (mobile only) */
.pad-fab{
  position:absolute; right:12px; bottom:12px; z-index:6;
  width:56px; height:56px; border-radius:50%;
  background: var(--accent-color); color: var(--contrast-color);
  display:none; place-items:center; font:900 22px/1 var(--heading-font,system-ui);
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
}
@media (max-width: 767.98px){
  .pad-fab{ display:grid; }
}

/* Bottom sheet controller (mobile) */
.position-sheet{
  position:fixed; left:0; right:0; bottom:0; z-index:60;
  height: min(38vh, 320px); padding:10px 12px calc(12px + env(safe-area-inset-bottom));
  background: linear-gradient(180deg, rgba(20,22,28,.98), rgba(20,22,28,.96));
  border-top: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 -18px 50px rgba(0,0,0,.4);
  transform: translateY(110%); transition: transform .28s ease;
}
.position-sheet.is-open{ transform: translateY(0%); }
.position-sheet .sheet-grip{
  width:42px; height:4px; border-radius:2px; background: rgba(255,255,255,.25);
  margin: 4px auto 10px;
}
.position-sheet .pad-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
.position-sheet .pad-grid button{
  height:52px; border-radius:10px; border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06); color:#fff; font:700 18px/1 var(--heading-font,system-ui);
}
.position-sheet .pad-step{ display:flex; align-items:center; gap:10px; margin-top:10px; }
.position-sheet .pad-step span{ font:700 12px/1 var(--heading-font,system-ui); opacity:.85; width:42px; }
.position-sheet .pad-step input[type="range"]{ flex:1; accent-color:var(--accent-color); }
.position-sheet .pad-step output{ font:700 12px/1 var(--heading-font,system-ui); opacity:.85; min-width:58px; text-align:right; }

/* When sheet is open, avoid covering content when scrolling to #frame */
@media (max-width: 767.98px){
  #frame{ scroll-margin-bottom: 40vh; }
}
